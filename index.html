<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI Learning Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0 auto;
            background-color: #f0e6ff;
        }
        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
         h1, h2 {
            color: #4b0082;
            text-align: center;
        }
        form, .result {
            background-color: #d8c3ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
             display: flex;
            flex-direction: column;
            align-items: center;
        }
        form button {
            margin-right: 5px;
            margin-left: 5px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #4b0082;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #9370db;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4b0082;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: inline-block;
        }
         form#generatorForm button, form#topicAnalysisForm button, form#roadmapForm button{
            display: inline-block;
        }
        button:hover {
            background-color: #6a0dad;
        }
        #error {
            color: red;
            margin-top: 10px;
        }
        .loading {
            text-align: center;
            color: #4b0082;
        }
        .quiz-question {
            margin-bottom: 15px;
        }
        .sample-answer {
            margin-top: 10px;
            font-style: italic;
            color: #4b0082;
        }
        #roadmapResult {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .result p {
            white-space: pre-line;
        }
        .result {
            background-color: #d5c4f6;
        }
        .result ul {
            margin-left: 20px;
            margin-bottom: 15px;
            padding-left: 20px;
        }
        .result h3 {
            margin-bottom: 10px;
            color: #4b0082;
            font-size: 1.3em;
            font-weight: bold;
            text-decoration: underline;
        }
        .result section {
            margin-bottom: 20px;
            border-bottom: 1px solid #9370db;
            padding-bottom: 10px;
        }
        .result h2 {
            color: #4b0082;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .result h3 {
            color: #6a0dad;
            margin-top: 15px;
            margin-bottom: 8px;
        }
        .result p {
            margin-bottom: 10px;
        }
        .result ul, .result ol {
            margin-bottom: 15px;
        }
        .result li {
            margin-bottom: 8px;
        }
        header img{
            width: 100vw;
            height: 40vh;
            position: fixed;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            object-fit: cover;
            z-index: -1;
        }
        h1{
            position:relative;
            padding-top:40vh;
        }
    </style>
</head>
<body>
    <header>
        <img src="/images/header.png" alt="header">
    </header>
      <main>
      <h1>Gemini AI Learning Assistant</h1>
       <form id="generatorForm">
        <label for="topic">Topic:</label>
        <input type="text" id="topic" required>

        <label for="educationLevel">Education Level:</label>
        <select id="educationLevel" required>
            <option value="elementary">Elementary</option>
            <option value="middle">Middle School</option>
            <option value="high">High School</option>
            <option value="college">College</option>
            <option value="graduate">Graduate</option>
        </select>

        <label for="wordCount">Word Count for Explanation:</label>
        <input type="number" id="wordCount" min="50" max="500" value="200" required>

        <label for="quizQuestions">Number of Quiz Questions:</label>
        <select id="quizQuestions" required>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="15">15</option>
            <option value="20">20</option>
        </select>

         <div style="text-align: center;">
           <button type="button" onclick="generateExplanation()">Generate Explanation</button>
           <button type="button" onclick="generateQuiz()">Generate Quiz</button>
        </div>
    </form>

    <div id="resultContainer"></div>

    <form id="topicAnalysisForm">
        <h2>Topic Analysis</h2>
        <label for="analysisTopic">Topic:</label>
        <input type="text" id="analysisTopic" required>

        <label for="analysisContext">Context (e.g., preparing for exams, doing research):</label>
        <input type="text" id="analysisContext" required>

        <label for="topicKnowledge">Write everything you know about this topic:</label>
        <textarea id="topicKnowledge" rows="10" required></textarea>

        <div style="text-align: center;">
          <button type="button" onclick="analyzeKnowledge()">Analyze Knowledge</button>
        </div>
    </form>

    <div id="analysisResultContainer"></div>

    <form id="roadmapForm">
        <h2>Learning Roadmap</h2>
        <label for="roadmapTopic">Topic:</label>
        <input type="text" id="roadmapTopic" required>

        <label for="proficiencyLevel">Proficiency Level:</label>
        <select id="proficiencyLevel" required>
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
        </select>

        <div style="text-align: center;">
             <button type="button" onclick="generateRoadmap()">Generate Roadmap</button>
        </div>
    </form>

    <div id="roadmapResultContainer"></div>

    <div id="error"></div>
    </main>
    <script>
        
const API_KEY = "AIzaSyCAMKmbieLWaJhhY3k4tZ4rIw6r03RPV7A";

        
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
        let currentExplanation = '';
        let currentQuiz = '';

        mermaid.initialize({ startOnLoad: true });

        async function generateExplanation() {
            const topic = document.getElementById('topic').value;
            const educationLevel = document.getElementById('educationLevel').value;
            const wordCount = document.getElementById('wordCount').value;
            const resultContainer = document.getElementById('resultContainer');
            const errorDiv = document.getElementById('error');

            resultContainer.innerHTML = '<div class="result"><p class="loading">Generating explanation...</p></div>';
            errorDiv.textContent = '';

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Explain the topic "${topic}" at a ${educationLevel} education level in approximately ${wordCount} words.`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Failed to generate explanation with status: ${response.status}, ${response.statusText}, ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                text = text.replace(/##(.*?)##/g, '<h1>$1</h1>').replace(/\*\*(.*?)\*\*/g, '<h2>$1</h2>');
                text = text.replace(/##/g, '').replace(/\*\*/g, ''); // Remove the symbols

                currentExplanation = text;
                resultContainer.innerHTML = `
                    <div class="result">
                        <h2>Explanation:</h2>
                         <p>${currentExplanation}</p>
                        <button onclick="downloadPDF('explanation')">Download Explanation as PDF</button>
                    </div>
                `;
            } catch (error) {
                console.error('Error:', error);
                errorDiv.textContent = 'An error occurred while generating the explanation. Please try again.';
                resultContainer.innerHTML = '';
            }
        }

        async function generateQuiz() {
            const topic = document.getElementById('topic').value;
            const educationLevel = document.getElementById('educationLevel').value;
            const quizQuestions = document.getElementById('quizQuestions').value;
            const resultContainer = document.getElementById('resultContainer');
            const errorDiv = document.getElementById('error');

            resultContainer.innerHTML = '<div class="result"><p class="loading">Generating quiz...</p></div>';
            errorDiv.textContent = '';

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a quiz with ${quizQuestions} questions about "${topic}" at a ${educationLevel} education level. For each question, provide a sample answer. Format the response as a numbered list with questions followed by sample answers. Use proper line spacing between questions and answers for better readability.`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Failed to generate quiz with status: ${response.status}, ${response.statusText}, ${JSON.stringify(errorData)}`);
                }

                 const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                 text = text.replace(/##(.*?)##/g, '<h1>$1</h1>').replace(/\*\*(.*?)\*\*/g, '<h2>$1</h2>');
                  text = text.replace(/##/g, '').replace(/\*\*/g, '');

                 currentQuiz = text;
                resultContainer.innerHTML = `
                    <div class="result">
                        <h2>Quiz:</h2>
                        <div style="white-space: pre-wrap;">${currentQuiz}</div>
                        <button onclick="downloadPDF('quiz')">Download Quiz as PDF</button>
                    </div>
                `;
            } catch (error) {
                console.error('Error:', error);
                errorDiv.textContent = 'An error occurred while generating the quiz. Please try again.';
                resultContainer.innerHTML = '';
            }
        }

        async function analyzeKnowledge() {
            const topic = document.getElementById('analysisTopic').value;
            const context = document.getElementById('analysisContext').value;
            const knowledge = document.getElementById('topicKnowledge').value;
            const analysisResultContainer = document.getElementById('analysisResultContainer');
            const errorDiv = document.getElementById('error');

            analysisResultContainer.innerHTML = '<div class="result"><p class="loading">Analyzing your knowledge...</p></div>';
            errorDiv.textContent = '';

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Analyze the following knowledge about the topic "${topic}" in the context of "${context}". Provide feedback in the following structure:

Strengths:
• [List at least 3 strengths, each starting with a bullet point]

Weaknesses:
• [List at least 3 weaknesses, each starting with a bullet point]

Points to Consider:
• [List at least 3 important points to remember, each starting with a bullet point]

Ensure each section has at least 3 bullet points and maintain this exact formatting.

User's Knowledge:
${knowledge}`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Failed to analyze knowledge with status: ${response.status}, ${response.statusText}, ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                let analysis = data.candidates[0].content.parts[0].text;
                  analysis = analysis.replace(/##(.*?)##/g, '<h1>$1</h1>').replace(/\*\*(.*?)\*\*/g, '<h2>$1</h2>');
                    analysis = analysis.replace(/##/g, '').replace(/\*\*/g, '');

                const formattedAnalysis = formatAnalysis(analysis);

                analysisResultContainer.innerHTML = `
                    <div class="result">
                        <h2>Knowledge Analysis:</h2>
                        ${formattedAnalysis}
                        <button onclick="downloadPDF('analysis')">Download Analysis as PDF</button>
                    </div>
                `;
            } catch (error) {
                console.error('Error:', error);
                errorDiv.textContent = 'An error occurred while analyzing your knowledge. Please try again.';
                analysisResultContainer.innerHTML = '';
            }
        }

        function formatAnalysis(analysisText) {
            const sections = analysisText.split(/\n\n(?=Strengths:|Weaknesses:|Points to Consider:)/);
            let formattedAnalysis = '';

            sections.forEach(section => {
                const [title, ...points] = section.split('\n');
                formattedAnalysis += `<section><h3>${title}</h3><ul>`;
                points.forEach(point => {
                    if (point.trim().startsWith('•')) {
                        formattedAnalysis += `<li>${point.trim().substring(1).trim()}</li>`;
                    }
                });
                formattedAnalysis += '</ul></section>';
            });

            return formattedAnalysis;
        }

         async function generateRoadmap() {
            const topic = document.getElementById('roadmapTopic').value;
            const proficiencyLevel = document.getElementById('proficiencyLevel').value;
            const roadmapResultContainer = document.getElementById('roadmapResultContainer');
            const errorDiv = document.getElementById('error');

            roadmapResultContainer.innerHTML = '<div class="result"><p class="loading">Generating learning roadmap...</p></div>';
            errorDiv.textContent = '';

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Create a detailed and structured learning plan for the topic "${topic}" at a "${proficiencyLevel}" proficiency level. Organize the plan into main sections with ##Section Title## format. Use **Subsection Title** for subsections. Provide specific to-do items and resources (such as documentation links, course links, relevant YouTube video links, and blog links) under each section. Ensure proper formatting and hierarchy. Each point should be on a new line. Format the links in markdown as follows: *** <a href="link of resource">Topic name</a>`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Failed to generate roadmap with status: ${response.status}, ${response.statusText}, ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0].text) {
                    throw new Error('Unexpected API response structure');
                }
                 let roadmap = data.candidates[0].content.parts[0].text;
                 roadmap = roadmap.replace(/##(.*?)##/g, '<h1>$1</h1>').replace(/\*\*(.*?)\*\*/g, '<h2>$1</h2>');
                  roadmap = roadmap.replace(/##/g, '').replace(/\*\*/g, '');

                const formattedRoadmap = formatRoadmap(roadmap);

                roadmapResultContainer.innerHTML = `
                    <div class="result">
                        <h2>Learning Roadmap:</h2>
                        ${formattedRoadmap}
                        <button onclick="downloadPDF('roadmap')">Download Roadmap as PDF</button>
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                errorDiv.textContent = 'An error occurred while generating the learning roadmap. Please try again.';
                roadmapResultContainer.innerHTML = '';
            }
        }


         function formatRoadmap(roadmapText) {
            const lines = roadmapText.split('\n');
            let formattedRoadmap = '';
            let inList = false;

            for (const line of lines) {
                const trimmedLine = line.trim();
                 if (trimmedLine.startsWith('<h1>') && trimmedLine.endsWith('</h1>')) {
                    if (inList) {
                        formattedRoadmap += '</ul>\n';
                        inList = false;
                    }
                    formattedRoadmap += trimmedLine + '\n';
                } else if (trimmedLine.startsWith('<h2>') && trimmedLine.endsWith('</h2>')) {
                      if (inList) {
                        formattedRoadmap += '</ul>\n';
                        inList = false;
                    }
                       formattedRoadmap += trimmedLine+ '\n';
                } else if (trimmedLine.startsWith('-') || trimmedLine.startsWith('*')) {
                    if (!inList) {
                        formattedRoadmap += '<ul>\n';
                        inList = true;
                    }
                    const content = trimmedLine.slice(1).trim();
                   formattedRoadmap += `<li>${formatLinks(content)}</li>\n`;
                }
                 else if (trimmedLine !== '') {
                      if (inList) {
                        formattedRoadmap += '</ul>\n';
                        inList = false;
                    }
                     formattedRoadmap += `<p>${formatLinks(trimmedLine)}</p>\n`;
                }
            }

            if (inList) {
                formattedRoadmap += '</ul>\n';
            }
            return formattedRoadmap;
        }

        function formatLinks(text) {
             const linkRegex = /\[([^\]]+)\]$$([^)]+)$$/g;
             return text.replace(linkRegex, (match, topic, url) => {
                  return `*** <a href="${url}" target="_blank" rel="noopener noreferrer">${topic}</a>`;
                });

        }


        function downloadPDF(type) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let content = '';
            let filename = '';

            if (type === 'explanation') {
                content = currentExplanation;
                filename = 'explanation.pdf';
            } else if (type === 'quiz') {
                content = currentQuiz;
                filename = 'quiz.pdf';
            } else if (type === 'analysis') {
                content = document.getElementById('analysisResultContainer').innerText;
                filename = 'knowledge_analysis.pdf';
            } else if (type === 'roadmap') {
                content = document.getElementById('roadmapResultContainer').innerText;
                filename = 'learning_roadmap.pdf';
            }

            const splitText = doc.splitTextToSize(content, 180);
            doc.text(splitText, 15, 15);
            doc.save(filename);
        }
    </script>
</body>
</html>